<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ì¹´ì¹´ì˜¤ë§µ íì—… ë§¤ì¥ ì²´í¬ í”„ë¡œê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 100;
            max-width: 350px;
        }

        .info-panel h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 8px;
        }

        .info-panel p {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .stats {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .stats span {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .stats .normal {
            background: linear-gradient(135deg, #4ECDC4 0%, #44a8a0 100%);
            color: white;
        }

        .stats .closed {
            background: linear-gradient(135deg, #FF6B6B 0%, #ee5a5a 100%);
            color: white;
        }

        .legend {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
            color: #555;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .legend-desc {
            font-size: 11px;
            color: #888;
            margin-left: 24px;
            margin-top: -4px;
        }

        .iwContent {
            padding: 10px 14px;
            font-size: 13px;
            line-height: 1.5;
            min-width: 200px;
        }

        .iwContent .name {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            margin-bottom: 6px;
        }

        .iwContent .address {
            color: #666;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .iwContent .status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .iwContent .status.normal {
            background: #E3F2FD;
            color: #1976D2;
        }

        .iwContent .status.closed {
            background: #FFEBEE;
            color: #D32F2F;
        }

        .iwContent .match-reason {
            margin-top: 6px;
            font-size: 11px;
            color: #888;
        }
    </style>
</head>

<body>
    <div class="info-panel">
        <h2>ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ íì—… ë§¤ì¥ ì²´í¬ í”„ë¡œê·¸ë¨</h2>
        <p>ì¹´ì¹´ì˜¤ API í¸ì˜ì ê³¼ ê³µê³µë°ì´í„° ë¹„êµ ê²°ê³¼</p>
        <div class="stats">
            <span class="normal">ğŸ”µ ì •ìƒ: {{ normal_count }}ê°œ</span>
            <span class="closed">ğŸ”´ íì—…: {{ closed_count }}ê°œ</span>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #4285F4;"></div>
                ì •ìƒ ì˜ì—…
            </div>
            <div class="legend-desc">ê³µê³µë°ì´í„°ì—ì„œ í™•ì¸ë¨</div>
            <div class="legend-item" style="margin-top: 10px;">
                <div class="legend-color" style="background: #EA4335;"></div>
                íì—… ì¶”ì •
            </div>
            <div class="legend-desc">ì¹´ì¹´ì˜¤ë§µ ì—…ë°ì´íŠ¸ í•„ìš”!</div>
        </div>
    </div>

    <div id="map"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_js_key }}"></script>

    <script>
        // Djangoì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
        var stores = JSON.parse('{{ stores_json|escapejs }}');

        // ì˜ë“±í¬êµ¬ ì¤‘ì‹¬ ì¢Œí‘œ
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.5171, 126.9066),  // ì˜ë“±í¬êµ¬ì²­ ë¶€ê·¼
            level: 5
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // ë§ˆì»¤ ìƒì„±
        stores.forEach(function (store) {
            if (!store.lat || !store.lng) return;  // ì¢Œí‘œ ì—†ëŠ” ê²½ìš° ìŠ¤í‚µ

            var markerPosition = new kakao.maps.LatLng(store.lat, store.lng);

            // ìƒíƒœë³„ ë§ˆì»¤ ì´ë¯¸ì§€ ì„¤ì •
            var markerColor = store.status === 'ì •ìƒ' ?
                'https://t1.daumcdn.net/localimg/localimages/07/2018/pc/img/marker_spot.png' :
                'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png';

            var imageSize = new kakao.maps.Size(36, 37);
            var imageOption = { offset: new kakao.maps.Point(13, 37) };
            var markerImage = new kakao.maps.MarkerImage(markerColor, imageSize, imageOption);

            var marker = new kakao.maps.Marker({
                position: markerPosition,
                title: store.name,
                image: markerImage
            });

            marker.setMap(map);

            // ì¸í¬ìœˆë„ìš° ë‚´ìš©
            var statusClass = store.status === 'ì •ìƒ' ? 'normal' : 'closed';
            var statusText = store.status === 'ì •ìƒ' ? 'ğŸ”µ ì •ìƒ ì˜ì—…' : 'ğŸ”´ íì—… ì¶”ì •';

            var iwContent = '<div class="iwContent">' +
                '<div class="name">' + store.name + '</div>' +
                '<div class="address">' + store.address + '</div>' +
                '<div class="status ' + statusClass + '">' + statusText + '</div>' +
                '<div class="match-reason">ë§¤ì¹­: ' + store.match_reason + '</div>' +
                '</div>';

            var infowindow = new kakao.maps.InfoWindow({
                content: iwContent,
                removable: true
            });

            // í´ë¦­ ì´ë²¤íŠ¸
            kakao.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
        });

        // ì§€ë„ ì»¨íŠ¸ë¡¤ ì¶”ê°€
        var zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    </script>

</body>

</html>