<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>êµì°¨ ë§¤ì¹­ í¸ì˜ì  ì§€ë„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 100;
            max-width: 320px;
        }

        .info-panel h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 8px;
        }

        .info-panel p {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .stats {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .stats span {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .legend {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 12px;
            color: #555;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .iwContent {
            padding: 8px 12px;
            font-size: 13px;
            line-height: 1.5;
        }

        .iwContent .name {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }

        .iwContent .address {
            color: #666;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .iwContent .match-reason {
            display: inline-block;
            background: #e8f4fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }
    </style>
</head>

<body>
    <div class="info-panel">
        <h2>ğŸª êµì°¨ ë§¤ì¹­ í¸ì˜ì </h2>
        <p>3ê°œ ë°ì´í„° ì†ŒìŠ¤ì—ì„œ êµì°¨ ê²€ì¦ëœ ì˜ë“±í¬êµ¬ í¸ì˜ì  í˜„í™©</p>
        <div class="stats">
            <span>ğŸ“ ì´ {{ store_count }}ê°œ</span>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #FF6B6B;"></div>
                ì†Œìƒê³µì¸ìƒê¶Œ
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ECDC4;"></div>
                OpenAPIì¸í—ˆê°€
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #45B7D1;"></div>
                ë‹¤ì´ì†Œê¸°ë°˜
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_js_key }}"></script>

    <script>
        // Djangoì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
        var stores = JSON.parse('{{ stores_json|escapejs }}');

        // ì¶œì²˜ë³„ ë§ˆì»¤ ìƒ‰ìƒ ì´ë¯¸ì§€
        var markerColors = {
            'ì†Œìƒê³µì¸ìƒê¶Œ': 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
            'OpenAPIì¸í—ˆê°€': 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png',
            'ë‹¤ì´ì†Œê¸°ë°˜': 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png'
        };

        // ì˜ë“±í¬êµ¬ ì¤‘ì‹¬ ì¢Œí‘œ
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.5171, 126.9066),  // ì˜ë“±í¬êµ¬ì²­ ë¶€ê·¼
            level: 5
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // ë§ˆì»¤ ìƒì„±
        stores.forEach(function (store) {
            if (!store.lat || !store.lng) return;  // ì¢Œí‘œ ì—†ëŠ” ê²½ìš° ìŠ¤í‚µ

            var markerPosition = new kakao.maps.LatLng(store.lat, store.lng);

            // ì¶œì²˜ë³„ ë§ˆì»¤ ì´ë¯¸ì§€ ì„¤ì •
            var imageSrc = markerColors[store.source] || markerColors['ì†Œìƒê³µì¸ìƒê¶Œ'];
            var imageSize = new kakao.maps.Size(24, 35);
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            var marker = new kakao.maps.Marker({
                position: markerPosition,
                title: store.name,
                image: markerImage
            });

            marker.setMap(map);

            // ì¸í¬ìœˆë„ìš° ë‚´ìš©
            var iwContent = '<div class="iwContent">' +
                '<div class="name">' + store.name + '</div>' +
                '<div class="address">' + store.address + '</div>' +
                '<div class="match-reason">' + store.match_reason + '</div>' +
                '</div>';

            var infowindow = new kakao.maps.InfoWindow({
                content: iwContent,
                removable: true
            });

            // í´ë¦­ ì´ë²¤íŠ¸
            kakao.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
        });

        // ì§€ë„ ì»¨íŠ¸ë¡¤ ì¶”ê°€
        var zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    </script>

</body>

</html>