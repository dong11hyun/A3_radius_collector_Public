## 영등포구 확장 프로젝트 - 1단계 상세설명

> 🎯 **목표**: 영등포구 다이소 수집 및 편의점 데이터 수집
> 
> 📁 **관련 파일**: 
> - `collect_yeongdeungpo_daiso.py` (영등포구 다이소 수집)
> - `collect_convenience_only.py` (편의점만 수집)
> - `deduplicate_stores.py` (중복 분석)
>
> 🐳 **실행 환경**: Docker (web + db 컨테이너)

---

### 1-1. Docker 환경 시작

```powershell
# 1. 프로젝트 폴더로 이동
cd C:\A3_radius_collector-Public

# 2. Docker Compose 실행 (백그라운드 모드)
docker compose up -d

# 3. 컨테이너 상태 확인
docker compose ps
```

**예상 결과:**
```
NAME                              IMAGE                    STATUS        PORTS
a3_radius_collector-public-db-1   postgis/postgis:16-3.4   Up           0.0.0.0:5433->5432/tcp
a3_radius_collector-public-web-1  a3_radius_...            Up           0.0.0.0:8000->8000/tcp
```

**컨테이너 구조:**
```
┌─────────────────────────────────────────────────────────────┐
│                    Docker Compose                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐    ┌─────────────────────┐         │
│  │        web          │    │         db          │         │
│  │  (Django + GDAL)    │───▶│  (PostGIS 16-3.4)   │         │
│  │   Port: 8000        │    │   Port: 5433        │         │
│  └─────────────────────┘    └─────────────────────┘         │
│           ↑                                                 │
│     localhost:8000                                          │
└─────────────────────────────────────────────────────────────┘
```

> ⚠️ **주의**: 카카오 API 키가 필요합니다. 
> 1. [카카오 개발자 사이트](https://developers.kakao.com/)에서 발급받으세요.
> 2. 프로젝트 루트의 `.env` 파일에 설정하면 자동으로 읽어옵니다:
>    ```
>    KAKAO_API_KEY=나의_API_키
>    ```

---

### 1-2. Docker에서 마이그레이션 실행

```powershell
# DB 마이그레이션 (최초 1회 또는 모델 변경 시)
docker compose exec web python manage.py migrate

# 마이그레이션 상태 확인
docker compose exec web python manage.py showmigrations
```

---

### 1-3. 영등포구 다이소 수집

```
수집 흐름:
┌───────────────────────┐        ┌──────────────────────┐
│  카카오 키워드 검색    │   →    │   YeongdeungpoDaiso  │
│  "서울 영등포구 다이소" │        │   (yeongdeungpo_daiso)│
└───────────────────────┘        └──────────────────────┘
           ↓
    [주소 검증: 영등포구만]
           ↓
    ✅ 영등포구 주소 → 저장
    ❌ 다른 지역 → 스킵
```

**Docker에서 실행:**
```powershell
# 영등포구 다이소만 수집 (.env에서 API 키 자동 로드)
docker compose exec web python manage.py collect_yeongdeungpo_daiso

# 또는 직접 API 키를 지정할 수도 있음
# docker compose exec web python manage.py collect_yeongdeungpo_daiso --api-key=YOUR_KEY
```

**예상 결과:**
```
--- 검색 시작: 서울 영등포구 다이소 ---
  ✅ 다이소 영등포타임스퀘어점 - 생성
  ✅ 다이소 영등포역점 - 생성
  ⚠️ 영등포구 아님, 스킵: 다이소 구로디지털점 (서울 구로구 ...)
  ✅ 다이소 당산역점 - 생성
  ...
--- 수집 완료 ---
  ✅ 수집된 다이소: 15개
  ⚠️ 스킵된 항목: 3개
```

**수집 확인 (Docker Shell):**
```powershell
# Django Shell 접속
docker compose exec web python manage.py shell

>>> from stores.models import YeongdeungpoDaiso
>>> YeongdeungpoDaiso.objects.count()
# 예상: 10~20개
>>> exit()
```

**또는 PostgreSQL 직접 확인:**
```powershell
# PostgreSQL 접속
docker compose exec db psql -U postgres -d radius_collector

# SQL 쿼리
SELECT COUNT(*) FROM yeongdeungpo_daiso;
\q
```

---

### 1-4. 편의점 데이터 수집

```
수집 흐름:
┌──────────────────┐
│   DaisoStore     │   영등포구 다이소 목록
│  (영등포구만)    │
└───────┬──────────┘
        ↓
┌───────────────────────────────────────────┐
│  각 다이소 지점 기준 반경 1km 내 검색      │
│  카카오 카테고리: CS2 (편의점)             │
│  ※ CE7 (카페)는 제외!                     │
└───────┬───────────────────────────────────┘
        ↓
┌──────────────────────────┐
│ YeongdeungpoConvenience  │   편의점 데이터 저장
│ (yeongdeungpo_convenience)│
└──────────────────────────┘
```

**Docker에서 실행:**
```powershell
# 영등포구 다이소 기준 편의점만 수집 (.env에서 API 키 자동 로드)
docker compose exec web python manage.py collect_convenience_only
```

**예상 결과:**
```
총 15개의 영등포구 다이소에 대해 편의점 수집을 시작합니다.
[1/15] '다이소 영등포타임스퀘어점' 주변 편의점 탐색 중...
  -> 42개 편의점 저장
[2/15] '다이소 영등포역점' 주변 편의점 탐색 중...
  -> 38개 편의점 저장
...
--- 수집 완료 ---
  ✅ 수집된 편의점: 287개

📊 현재 DB 상태:
  - 편의점: 287개
  - 카페: 0개
```

**수집 확인:**
```powershell
docker compose exec web python manage.py shell

>>> from stores.models import YeongdeungpoConvenience
>>> YeongdeungpoConvenience.objects.count()
# 예상: 200~400개
>>> exit()
```

---

### 1-5. 중복 데이터 분석

```
중복 발생 원인:
┌─────────────────────┐     ┌─────────────┐
│ 다이소 A (타임스퀘어)│ ──→ │  GS25 영등포역점 │
└─────────────────────┘     └─────────────┘
                                  ↑
┌─────────────────────┐           │ 동일 편의점!
│ 다이소 B (영등포역) │ ──────────┘
└─────────────────────┘

해결: place_id 기준으로 고유 편의점만 식별
```

**Docker에서 실행:**
```powershell
# 중복 데이터 분석
docker compose exec web python manage.py deduplicate_stores

# 상세 정보 출력
docker compose exec web python manage.py deduplicate_stores --verbose
```

**예상 결과:**
```
총 287개의 편의점 데이터 확인 중...
고유 편의점 수: 156개

📊 중복 분석 결과:
  - 원본 데이터: 287개
  - 고유 편의점: 156개
  - 중복 데이터: 131개 (45.6%)

🔗 여러 다이소에서 발견된 편의점: 89개

🏪 브랜드별 분포:
  - CU: 52개 (33.3%)
  - GS25: 48개 (30.8%)
  - 세븐일레븐: 32개 (20.5%)
  - 이마트24: 18개 (11.5%)
  - 미니스톱: 4개 (2.6%)
  - 기타: 2개 (1.3%)

중복 분석 완료!
```

---

### 1-6. 1단계 완료 확인

```powershell
# Django Shell에서 전체 확인
docker compose exec web python manage.py shell
```

```python
>>> from stores.models import YeongdeungpoDaiso,YeongdeungpoConvenience

# 1. 영등포구 다이소 수
>>> YeongdeungpoDaiso.objects.filter(address__contains='영등포').count()
# 예상: 10~20

# 2. 편의점만 있는지 확인
>>> YeongdeungpoConvenience.objects.filter(address__contains='영등포').count()
# 예상: 100~300
>>> exit()
```

---

### 1-7. Docker 관리 명령어

```powershell
# 로그 확인 (실시간)
docker compose logs -f web

# 컨테이너 중지 (데이터 유지)
docker compose down

# 컨테이너 중지 + 데이터 삭제 (초기화)
docker compose down -v

# 컨테이너 재시작
docker compose restart web

# web 컨테이너만 재빌드
docker compose up -d --build web
```

---

### 1단계 요약

| 작업 | Docker 명령어 | 결과 |
|------|--------------|------|
| 환경 시작 | `docker compose up -d` | web + db 컨테이너 |
| 마이그레이션 | `docker compose exec web python manage.py migrate` | DB 테이블 생성 |
| 영등포구 다이소 수집 | `docker compose exec web python manage.py collect_yeongdeungpo_daiso` | DaisoStore 10~20개 |
| 편의점 수집 | `docker compose exec web python manage.py collect_convenience_only` | NearbyStore 100~300개 |
| 중복 분석 | `docker compose exec web python manage.py deduplicate_stores` | 통계 확인 |

```
1단계 완료 후 데이터 구조:
┌──────────────────────────┐
│   YeongdeungpoDaiso      │  ← PostgreSQL (PostGIS)
│  영등포구 다이소          │     yeongdeungpo_daiso 테이블
│  (10~20개)               │
└────────┬─────────────────┘
         │ 1:N 관계
         ↓
┌──────────────────────────┐
│ YeongdeungpoConvenience  │
│  영등포구 편의점          │
│  (100~300개)             │
│  yeongdeungpo_convenience │
└──────────────────────────┘
```

---

> 📌 **다음 단계**: [2단계 - 공공데이터 비교 및 폐업 매장 탐지](./영등포구확장(2단계)상세설명.md)
